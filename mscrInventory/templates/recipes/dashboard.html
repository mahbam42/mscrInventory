{% extends "base.html" %}
{% block content %}
<div class="container mx-auto px-4 py-6">
  <h1 class="text-2xl font-bold mb-4">Recipe Dashboard</h1>

  <!-- Summary Section -->
  <div class="grid grid-cols-3 gap-4 mb-8">
    <div class="bg-gray-100 p-4 rounded shadow">
      <p class="text-lg font-semibold">Total Products</p>
      <p class="text-2xl">{{ total_products }}</p>
    </div>
    <div class="bg-gray-100 p-4 rounded shadow">
      <p class="text-lg font-semibold">Products w/o Recipes</p>
      <p class="text-2xl text-red-600">{{ products_without_recipes }}</p>
    </div>
    <div class="bg-gray-100 p-4 rounded shadow">
      <p class="text-lg font-semibold">Total Modifiers</p>
      <p class="text-2xl">{{ total_modifiers }}</p>
    </div>
  </div>

  <!-- Products Table -->
  <div class="bg-white rounded shadow p-4">
    <h2 class="text-xl font-semibold mb-3">Products</h2>
    <table class="min-w-full table-auto">
      <thead>
        <tr class="border-b">
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Categories</th>
          <th class="px-4 py-2 text-center"># Recipe Items</th>
          <th class="px-4 py-2 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr class="border-b hover:bg-gray-50">
          <td class="px-4 py-2">{{ product.name }}</td>
          <td class="px-4 py-2">
            {{ product.categories.all|join:", " }}
          </td>
          <td class="px-4 py-2 text-center">{{ product.recipe_items.count }}</td>
	  <td>{% if modifier.type == "EXTRA" %}
	    <button 
	      class="btn btn-sm btn-outline-primary"
	      hx-get="{% url 'edit_modifier_extra' modifier.id %}"
	      hx-target="#extraModal .modal-body"
	      hx-trigger="click"
	      data-bs-toggle="modal"
	      data-bs-target="#extraModal">
	      Edit Extra Config
	    </button>
	    {% endif %}
	  </td>
          <td class="px-4 py-2 text-center">
            <button
              class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700"
              hx-get="{% url 'edit_recipe' product.id %}"
	      hx-target="#modal-body"
              hx-trigger="click"
            >
              Edit Recipe
            </button>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="px-4 py-3 text-center text-gray-500">No products found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Recipe Edit Modal -->
<div id="recipe-modal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white rounded-lg shadow-lg max-w-lg w-full">
    <div id="recipe-modal-content" class="p-4">
      <!-- Loaded dynamically via HTMX -->
    </div>
  </div>
</div>

{% endblock %}
