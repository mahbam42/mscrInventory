{% extends "base.html" %}
{% block title %}Recipes{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-3">☕ Recipe Dashboard</h2>
  <hr />
  <!-- Edit Widgets -->
  <button class="btn btn-warning" hx-get="{% url 'unmapped_ingredients_partial' %}" hx-target="#modal-body"
    data-bs-toggle="modal" data-bs-target="#globalModal">
    ⚠️ View Unmapped Ingredients
  </button>
  <hr />
  <!-- Category Filter -->
    <form method="get" class="mb-3 d-flex gap-2 align-items-center" id="recipes-filter">
      <label for="category" class="form-label mb-0">Category</label>
      <select name="category" id="category" class="form-select form-select-sm" onchange="this.form.submit()">
        <option value="">All</option>
        {% for c in categories %}
        {% with c.categories__id|stringformat:"s" as cat_id %}
        <option value="{{ cat_id }}" {% if selected_category == cat_id or selected_category == c.categories__name %} selected {% endif %}>
          {{ c.categories__name }}
        </option>
        {% endwith %}
        {% endfor %}
      </select>
    </form>
  <!-- Recipes Table -->
  <div id="recipes-table-wrap"
    hx-get="{% url 'recipes_table_fragment' %}{% if selected_category %}?category={{ selected_category }}{% endif %}"
    hx-trigger="load, recipes:refresh from:body" 
    hx-target="this" 
    hx-swap="innerHTML">
    {% include "recipes/_table.html" with products=products %}
  </div>
  
</div>

<!-- Global modal container -->
<div class="modal fade" id="globalModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content"></div>
  </div>
</div>
{% endblock %}
