<div id="ingredients-table">
  <table class="table table-hover align-middle">
    <thead>
      <tr>
        <th>
          <button type="button" class="btn btn-link p-0 text-decoration-none"
                  hx-get="{% url 'ingredients_table_partial' %}?sort=name&direction={{ toggle_directions.name }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}"
                  hx-target="#ingredients-table-wrap" hx-swap="innerHTML">
            Name {% if sort_indicators.name %}<span>{{ sort_indicators.name }}</span>{% endif %}
          </button>
        </th>
        <th>
          <button type="button" class="btn btn-link p-0 text-decoration-none"
                  hx-get="{% url 'ingredients_table_partial' %}?sort=category&direction={{ toggle_directions.category }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}"
                  hx-target="#ingredients-table-wrap" hx-swap="innerHTML">
            Category {% if sort_indicators.category %}<span>{{ sort_indicators.category }}</span>{% endif %}
          </button>
        </th>
        <th>
          <button type="button" class="btn btn-link p-0 text-decoration-none"
                  hx-get="{% url 'ingredients_table_partial' %}?sort=current_stock&direction={{ toggle_directions.current_stock }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}"
                  hx-target="#ingredients-table-wrap" hx-swap="innerHTML">
            Current Stock {% if sort_indicators.current_stock %}<span>{{ sort_indicators.current_stock }}</span>{% endif %}
          </button>
        </th>
        <th>
          <button type="button" class="btn btn-link p-0 text-decoration-none"
                  hx-get="{% url 'ingredients_table_partial' %}?sort=case_size&direction={{ toggle_directions.case_size }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}"
                  hx-target="#ingredients-table-wrap" hx-swap="innerHTML">
            Case Size {% if sort_indicators.case_size %}<span>{{ sort_indicators.case_size }}</span>{% endif %}
          </button>
        </th>
        <th>
          <button type="button" class="btn btn-link p-0 text-decoration-none"
                  hx-get="{% url 'ingredients_table_partial' %}?sort=reorder_point&direction={{ toggle_directions.reorder_point }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}"
                  hx-target="#ingredients-table-wrap" hx-swap="innerHTML">
            Reorder Point {% if sort_indicators.reorder_point %}<span>{{ sort_indicators.reorder_point }}</span>{% endif %}
          </button>
        </th>
        <th>
          <button type="button" class="btn btn-link p-0 text-decoration-none"
                  hx-get="{% url 'ingredients_table_partial' %}?sort=avg_cost&direction={{ toggle_directions.avg_cost }}{% if search_query %}&q={{ search_query|urlencode }}{% endif %}{% if active_type %}&type={{ active_type }}{% endif %}"
                  hx-target="#ingredients-table-wrap" hx-swap="innerHTML">
            Avg Cost {% if sort_indicators.avg_cost %}<span>{{ sort_indicators.avg_cost }}</span>{% endif %}
          </button>
        </th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for ingredient in all_ingredients %}
      <tr>
        <td>
          <div class="fw-semibold">{{ ingredient.name }}</div>
          <small class="text-muted">Unit: {{ ingredient.unit_type|default:"–" }}</small>
        </td>
        <td>{{ ingredient.type.name|default:"–" }}</td>
        <td>{{ ingredient.current_stock|default:0|floatformat:3 }}</td>
        <td>{{ ingredient.case_size|default:"–" }}</td>
        <td>{{ ingredient.reorder_point|default:0|floatformat:3 }}</td>
        <td>${{ ingredient.average_cost_per_unit|default:0|floatformat:4 }}</td>
        <td class="text-end">
          <button class="btn btn-sm btn-outline-secondary"
                  hx-get="{% url 'ingredient_edit_modal' ingredient.id %}"
                  hx-target="#globalModal .modal-content"
                  hx-swap="innerHTML"
                  data-bs-toggle="modal"
                  data-bs-target="#globalModal">
            ✏️ Edit
          </button>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center text-muted py-4">No ingredients match your filters.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
